<html>
<head>
    <title> Current temperature </title>
    <link type="text/css" rel="stylesheet" href="./css/current_temperature.css" />
    <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0;">
    <script src="./jquery/jquery-2.1.1.js"></script>

    <script language="javascript">
        function isMobileDevice() {
            var mobile = (/iphone|ipad|ipod|android|windows\sphone/i.test(navigator.userAgent.toLowerCase()));
            return mobile;
        }

        if(isMobileDevice()) {
            document.write("<link type=\"text\/css\" rel=\"stylesheet\" href=\"./css/mobile.css\" \/>");
        } else {
            document.write("<link type=\"text\/css\" rel=\"stylesheet\" href=\"./css/pc_mac.css\" \/>");
        }
    </script>
</head>

<body>

<div class="container">
    <div class="de">
        <div class="den">
          <div class="dene">
            <div class="denem">
              <div class="deneme">
                <label id="id_l_a">0</label><span>.<label id="id_l_b">0</label></span><strong>&deg;</strong>
              </div>
            </div>
          </div>
        </div>
    </div>
</div>

<div class="box">
<form id="id_form" class="text_form">
  <table>
    <tr>
      <td>Automode: </td>
      <td><input id="id_automode" type="checkbox"></td>
    </tr>
    <tr>
      <td>Target: </td>
      <td><input id="id_target" type="number"></td>
    </tr>
    <tr>
      <td>Tolerance: </td>
      <td>
      <select id="id_tolerance">
        <option value=0>0.0</option>
        <option value=500>0.5</option>
        <option value=1000>1.0</option>
        <option value=1500>1.5</option>
        <option value=2000>2.0</option>
      </select>
      </td>
    </tr>
    <tr>
      <td><input id="id_submit" type="submit" value="Submit"></td>
    </tr>
  </table>
</form>
</div>

<script language="javascript">

    function get_current_temperature() {
        $.get("./php/current.php", "", function(data) {
            if (data.length > 0) {
                var temp = parseInt(data);
                var a = Math.floor(temp / 1000);
                var b = Math.floor((temp % 1000) / 100);

                $("div.deneme").hide();
                $("#id_l_a").text(a.toString());
                $("#id_l_b").text(b.toString());
                $("div.deneme").show();
            }
        });
    }

    function disable_form(flag) {
        $("#id_target").prop("disabled", flag);
        $("#id_tolerance").prop("disabled", flag);
    }

    function load_setting() {
        $.get("./php/load.php", "", function(data) {
            if (data.length > 0) {
                var setting = JSON.parse(data);
                var target  = setting.target / 1000;
                var tolerance = setting.tolerance;

                $("#id_form").hide();
                if (setting.automode == "1") {
                    $("#id_automode").prop("checked", true);
                    disable_form(false);
                } else {
                    $("#id_automode").prop("checked", false);
                    disable_form(true);
                }
                if (target < 0) {
                    target = 0;
                }
                $("#id_target").val(target);
                if (tolerance < 0) {
                    tolerance = 0;
                }
                $("#id_tolerance").val(tolerance);
                $("#id_form").show();
            }
        });
    }

    $(document).ready(function() {
        $("#id_form").submit(function(e) {
            var data = {
                "automode": $("#id_automode").prop("checked") ? 1 : 0,
                "target": $("#id_target").val() * 1000,
                "tolerance": $("#id_tolerance").val()
            };

            e.preventDefault();
            $.post("./php/submit.php", data, function(data) {
                    alert(data);
            });
        });

        $("#id_automode").click(function() {
            $this = $(this);

            if ($this.is(":checked")) {
                disable_form(false);
            } else {
                disable_form(true);
            }
        });

        load_setting();
        get_current_temperature();
        window.setInterval(get_current_temperature, 10000);
    });

</script>

</body>
</html>
